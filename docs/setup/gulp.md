# Gulp

Gulp is an open-source JavaScript toolkit used as a streaming build system in front-end web development. We tend to use it solely for project pre-compiling.

## Tasks

Here are the available Gulp tasks and what they do:

### Serve

`gulp serve`

This will run **core, scripts, svg** and **sass** tasks before starting a Browser Sync watcher.

### Development Javascript

`gulp scripts`

Compiles development Javascript files into one. If ESSupport is enabled, an ES5 transpiled version will be generated too.

### Core Javascript

`gulp core`

Compiles third party Javascript dependancies into one. If ESSupport is enabled, an ES5 transpiled version will be generated too.

### Sass

`gulp sass`

Generates yours sass files as expected. This also introduces extensions to sass so you can take advantage of some [PostCSS](https://github.com/postcss/postcss) tools.

### SVG Symbols

`gulp symbols`

This will pull all your svg images into a single */assets/images/symbols.svg* file and amend the syntax to put each image into a symbol. The idea is to render the symbols.svg directly into your markup and refer to your SVGâ€™s using something like this: `<svg class="icon-facebook"><use xlink:href="#icon-facebook" /></svg>`. This will allow you to reuse svg markup without duplicating any code. Take a look at the [Helpers module](https://github.com/marknotton/craft-module-helpers) to see how you can use the SVG and Symbols Twig extensions to make including symbols even easier.

### Config Settings

`gulp config`

Simply `console.logs` your _config.json_ settings.

### Default

`gulp` or `gulp default`

This will run **core, scripts, svg** and **sass** asynchronously.

## Config.json

In an attempt to keep gulp tasks consistent across projects, everything in the *gulpfile.js* relies on settings defined externally in the *config.json* file. The idea is to avoid modifying the *gulpfile.js* where possible.

Here's an overview on what the config.json manages:

| Configs           | Description      
------------------- | ----------------------------------------------------------
| project           | The full project name. It's default use is to title event handlers and push notification popups.
| settings          | A list of booleans that are pretty self explanatory. `sourceMaps` and `minify` effects both javascript and sass tasks.
| paths             | Locations for where assets are to be routed.
| themes            | Any preferences that help manage theming. Currently, these are used to define Sass variables, and brand the CMS.
| sass-variables    | These will be injected as variables at the very top of the Sass file compilation. [More Information](https://github.com/marknotton/gulp-inject-scss)
| sources           | Defines what files or directories should be included by their respective task.
| filenames         | Filenames for files that are generated by gulp tasks.
| deployer          | Manage Deployer settings, includes the option to add multiple hosts/branches.
| watchers          | You can manage all your watcher tasks from here too. You can define the `patterns` as you normally would. You can also decide what `tasks` should get called when a change to those files are triggered. You're able to define whether the page should `reload` after a task is completed or not.

Config options can use dynamic variables in the format of `{ }`. These will values will replace any instances throughout the config file. All Gulp commands will generate a `config.lock` file where the settings are locked down. Any dynamic variables and environmental settings will be managed in the lock file. This is to avoid performing all the same logic in other languages (php/twig). Each first level block can have different settings for each environment. Default properties will be found in the `"*"` object, and all other environment settings will be in their respective object.

### Settings
By default, different environments will have certain Gulp features enabled or disabled
unless explicitly declared otherwise in the config.json file. The following table illustrates what settings are enabled for each environment.

| Name            | Variable   | Defaults | Production | Staging    | Dev       
|-----------------|------------|--------- | -----------|----------- |-----------
| Source Maps     | sourceMaps | false *  | -          | false      | true      
| Minify          | minify     | true     | -          | -          | false     
| ES5 Support     | ES5Support | true     | -          | false      | false     
| Versioning      | versioning | true     | -          | false      | false     
| SVG Symbols     | symbols    | true     | -          | -          | -         
| Combine CSS     | combineCSS | false    | -          | -          | false     

` * = Forced behavior `
` - = Reverts defaults `

**It's important to know that the paths and settings defined in the config.json are respected throughout Craft 3. Both in Twig templating and the Helpers module. You shouldn't need to define any of these options more than once (in theory).**
