{% import "_components/macros/input-field" as input %}

{% if not craft.agent.isRobot() %}

	<script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.2.0/zxcvbn.js"></script>

  <form method="post" id="sign-up" accept-charset="UTF-8">

    {{ csrfInput() }}

    <input type="hidden" name="action" value="users/save-user">

    {% if redirectUrl is defined %}
      {{ redirectInput(redirectUrl) }}
    {% endif %}

    <fieldset>

      {{ legend is defined ? legend|t|wrap('legend') }}

      {% set message = message is defined ? message %}
      {{ message|t|p }}

      {% if errorMessage is defined %}
        <p class="error">{{ errorMessage }}</p>
      {% endif %}

      {{ input.field({
        type        : 'text',
        name        : 'loginName',
        placeholder : 'F020',
        required    : true
      })}}

			{% set errorlog %}
        {% if errors is defined %}
          <ul class="errors">
            {% for error in errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endset %}

      {{ input.field({ type : 'password', name : 'newPassword', placeholder : 'F022', note : errorLog ?? false }, true ) }}

      <div class="buttons">
        <button type="submit">{{ "F039"|t }}</button>
				<a class="have-account" href='{{ craft.helpers.relativeUrl(loginUrl) }}'>{{ "T026"|t }}</a>
      </div>

      {{ extra is defined ? extra|p('extra') }}

    </fieldset>

  </form>

	{% js %}

		var strength = {
			0: "{{ "F027"|t }}",
			1: "{{ "F028"|t }}",
			2: "{{ "F029"|t }}",
			3: "{{ "F030"|t }}",
			4: "{{ "F031"|t }}"
		}

		var password = $('#newPassword-input')[0];
		var note = $('#newPassword-input').parent().next('field-note');

		password.addEventListener('input', function() {
			var val = password.value;
			var result = zxcvbn(val);

			if ( result.score == 0 ) {
				password.setCustomValidity("Invalid field.");
			} else {
				password.setCustomValidity("");
			}

			if(val !== "") {
				note.html("<span data-strength="+result.score+">{{"F032"|t}} " + strength[result.score] + "</span>");
			} else {
				note.html('');
			}
		});

	{% endjs %}

{% elseif devmode %}

  {{ "E011"|t|p }}

{% endif %}
